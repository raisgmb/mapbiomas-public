/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var de_27_a_12 = 
    /* color: #d63000 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-78.60507095294055, -7.176642261107143],
                  [-78.57897842364368, -7.195376693678947],
                  [-78.56507385211047, -7.203551476565617],
                  [-78.55151260333118, -7.202359329905553],
                  [-78.55082595782336, -7.194525145323872],
                  [-78.55614746050891, -7.18583926087965],
                  [-78.58962142901477, -7.166763795043888],
                  [-78.60404098467883, -7.169318591292685]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-78.6270824471803, -7.170439611395741],
                  [-78.58588371671155, -7.139099865735891],
                  [-78.50211296475842, -7.012356486736364],
                  [-78.47602043546155, -6.953743010273692],
                  [-78.59137688077405, -6.802404792566669],
                  [-78.61334953702405, -6.630557719442291],
                  [-78.73557243741467, -6.524146065096854],
                  [-78.95255241788342, -6.360391811997295],
                  [-79.16403923428967, -6.207507399556607],
                  [-79.30960808194592, -6.061406712892966],
                  [-79.38376579678967, -5.900240484912301],
                  [-79.45380363858655, -5.7239967110056575],
                  [-79.4290844003053, -5.5367636089683865],
                  [-79.45243034757092, -5.430137108415542],
                  [-79.3925385638484, -5.1262320650269215],
                  [-79.45703893820253, -4.998870728211446],
                  [-79.444335996308, -4.976981281614471],
                  [-79.44758184907381, -4.94877281958738],
                  [-79.44380529878084, -4.926368629381329],
                  [-79.4388271188492, -4.921579849438508],
                  [-79.46234472749178, -4.914909705661979],
                  [-79.5014835214371, -4.994946998189452],
                  [-79.73656843763976, -5.582186846254295],
                  [-79.54980085951476, -5.981147105537054],
                  [-79.20373152357726, -6.7727212136310335],
                  [-78.83568953138976, -7.061739451351089]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-78.56460559205881, -7.228625259988226],
                  [-78.443069337176, -7.324662515922242],
                  [-78.410110352801, -7.430211505469122],
                  [-78.39843737916819, -7.621496725778593],
                  [-78.37234484987131, -7.684105456770199],
                  [-78.30505359010569, -7.784124135257016],
                  [-78.27758776979319, -7.905883338975424],
                  [-78.25226783841276, -7.927272381524981],
                  [-78.25016498654509, -7.927612423321562],
                  [-78.23532585375683, -7.872283882182043],
                  [-78.24837211840527, -7.804260870896834],
                  [-78.25111870043652, -7.7539167101206905],
                  [-78.26141838305371, -7.703566525292583],
                  [-78.32733635180371, -7.66886223563592],
                  [-78.34106926195996, -7.598764561652264],
                  [-78.30605034106152, -7.509594691188399],
                  [-78.3211565422334, -7.4449180598076605],
                  [-78.32733635180371, -7.372741296064349],
                  [-78.34106926195996, -7.31281201986244],
                  [-78.41797355883496, -7.269222034780621],
                  [-78.47633842699902, -7.228352581094446],
                  [-78.52646354906933, -7.209278902659133],
                  [-78.55461601488965, -7.212684975634956]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-78.23884607230573, -8.005071158267683],
                  [-78.19146753226667, -8.017310158222314],
                  [-78.1008025755863, -8.009305724999372],
                  [-78.09754100942419, -8.005565996078182],
                  [-78.09702602529333, -7.996896492479913],
                  [-78.10526577138708, -7.991116721017863],
                  [-78.11007228994177, -7.980916924687353],
                  [-78.1286117186527, -7.977856936130823],
                  [-78.14260212087439, -7.983041903260674],
                  [-78.14886776113318, -7.977474435950691],
                  [-78.15303054952429, -7.973224409875156],
                  [-78.15951076650427, -7.97381941618446],
                  [-78.16139904165075, -7.972586902154778],
                  [-78.16650596761511, -7.969866858053647],
                  [-78.17139831685827, -7.96973935554277],
                  [-78.18011013173864, -7.968591831157385],
                  [-78.18740574025915, -7.971099380277342],
                  [-78.19019523763464, -7.966339273934371],
                  [-78.195302163599, -7.966891789117431],
                  [-78.19761959218786, -7.971439385754698],
                  [-78.20216861867712, -7.973479412685116],
                  [-78.20658889913366, -7.973606914030485],
                  [-78.21315494680212, -7.975561929682499],
                  [-78.22302547597693, -7.9735644135864385],
                  [-78.22688785695837, -7.971099380277342],
                  [-78.23246685170935, -7.9716518890345744],
                  [-78.23444095754431, -7.970036861339681],
                  [-78.23615757131384, -7.970759374517463]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-78.09531858821582, -8.03491409527971],
                  [-77.9126708831377, -8.087943194717223],
                  [-77.76571327686865, -8.143222207131252],
                  [-77.76433998585303, -8.160214899284592],
                  [-77.75919014454443, -8.151378789455826],
                  [-77.7545552873667, -8.134895524625632],
                  [-77.735157551771, -8.129117724895659],
                  [-77.73704582691748, -8.10651553283595],
                  [-77.73996407032568, -8.092749665539499],
                  [-77.74047905445654, -8.07779362239535],
                  [-77.74957710743506, -8.070995237732745],
                  [-77.76948982716162, -8.072354923819436],
                  [-77.78871590138037, -8.06963554707047],
                  [-77.81669670582373, -8.061647272064043],
                  [-77.83523613453467, -8.07014543160498],
                  [-77.84896904469092, -8.066066337317732],
                  [-77.8644185686167, -8.054168743980085],
                  [-77.90973717213232, -8.045330305441366],
                  [-77.92930656910498, -8.039721196396465],
                  [-77.94853264332373, -8.046180163678613],
                  [-77.95728737354834, -8.030542487042398],
                  [-77.96724373341162, -8.004874995663645],
                  [-77.9794316911753, -7.978865888144784],
                  [-77.99093300343115, -7.9766558876186835],
                  [-78.00706917286475, -7.9768258880832725],
                  [-78.02354866505225, -7.991275669083508],
                  [-78.05358940601904, -8.001815186731523],
                  [-78.0702405595835, -7.9860058081710354],
                  [-78.08466011524756, -7.993655583968577],
                  [-78.09238487721045, -8.007764794111147]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-77.73046425814236, -8.264480000516585],
                  [-77.75054863924588, -8.273228655958308],
                  [-77.74763039583767, -8.276711076417907],
                  [-77.74539879793728, -8.274247904157175],
                  [-77.73007884189762, -8.269292803876652],
                  [-77.72492900058903, -8.266574768653019],
                  [-77.7261306302277, -8.264196472464702]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-77.76325158114041, -8.303295368166944],
                  [-77.75715760225857, -8.306352871070693],
                  [-77.75243691439236, -8.301002225361966],
                  [-77.74634293551053, -8.291914453707504],
                  [-77.74531296724881, -8.284864916048058],
                  [-77.7486603640994, -8.284949850988621]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-77.85178781404163, -8.324200942066259],
                  [-77.78312326326038, -8.658326880766472],
                  [-77.61695505036975, -8.80628043384315],
                  [-77.56065011872913, -8.795423457591916],
                  [-77.67279161751311, -8.574335743507001],
                  [-77.68480791389983, -8.528162912086204],
                  [-77.74694933235686, -8.445988652125878],
                  [-77.7548457556967, -8.402517492707387],
                  [-77.77964524263943, -8.377517995437795],
                  [-77.7706330203494, -8.371234246637163],
                  [-77.76282242769803, -8.372423071758302],
                  [-77.74951867098416, -8.367752666474884],
                  [-77.74016312594021, -8.361808433309534],
                  [-77.73981980318631, -8.353486354605622],
                  [-77.74299553865994, -8.35212763101882],
                  [-77.7501194858035, -8.344909332662978],
                  [-77.75715760225857, -8.341427517523888],
                  [-77.75363854403103, -8.322659150712399],
                  [-77.75432518953885, -8.317138871569407],
                  [-77.75801590914334, -8.311618514672476],
                  [-77.76076249117459, -8.311958231187331]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-77.25158530851324, -9.698328376671933],
                  [-77.24858123441656, -9.69638247835185],
                  [-77.24789458890875, -9.691729197454585],
                  [-77.25089866300543, -9.685637532188228],
                  [-77.25544768949469, -9.686398996393168]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-76.98958793371567, -10.057095466582537],
                  [-76.98151984899887, -10.056588395185056],
                  [-76.96932533054752, -10.04891529976964],
                  [-76.99473121433658, -10.051619735572492]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-76.58101026039591, -11.002140016208047],
                  [-76.57869283180705, -11.002519155027679],
                  [-76.57800618629923, -10.999612411612713],
                  [-76.57955113869181, -10.99843285538401]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-76.58126775246134, -11.011871091461451],
                  [-76.5794223926591, -11.011955341791372],
                  [-76.57903615456095, -11.009217193729823],
                  [-76.58126775246134, -11.008627435430398]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-75.80116313079695, -12.036037807896681],
                  [-75.79875987151961, -12.034568786661447],
                  [-75.80073397735457, -12.030245620444635],
                  [-75.80652754882674, -12.025670543594229],
                  [-75.80944579223494, -12.025712517130094]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "12"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-75.78785937408308, -12.0442641783828],
                  [-75.77919047454695, -12.055596010730468],
                  [-75.77223818878035, -12.053497559356835],
                  [-75.77507060150008, -12.050223942444884],
                  [-75.78356783965926, -12.042081696480496],
                  [-75.78674357513289, -12.04216563842007]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "13"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-75.7379917440782, -12.070116844295162],
                  [-75.73404353240828, -12.069445378008052],
                  [-75.73018115142683, -12.060380418482923],
                  [-75.73593180755476, -12.058785625381455]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "14"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-75.72288554290633, -12.094708136950183],
                  [-75.71413081268172, -12.09294569627706],
                  [-75.72134059051375, -12.076663552397195],
                  [-75.72580378631453, -12.077335000590713]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "15"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-75.65799754241804, -12.10024716057194],
                  [-75.65490763763289, -12.098988301645552],
                  [-75.65533679107527, -12.095967016032889],
                  [-75.65911334136824, -12.09697411503119]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "16"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-75.65293353179793, -12.121479020555293],
                  [-75.63782733062605, -12.123996520408893],
                  [-75.63568156341414, -12.120891600504178],
                  [-75.63705485442976, -12.116108274803882],
                  [-75.64675372222761, -12.114681652294866],
                  [-75.64683955291609, -12.109310769764656],
                  [-75.64958613494734, -12.108807243988556]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "17"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-75.65095942596297, -12.161001023779553],
                  [-75.6460670767198, -12.164692800793809],
                  [-75.6442646322618, -12.15923902122328],
                  [-75.64529460052351, -12.154456384008016]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "18"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.41181162990338, -4.90634061784578],
                  [-79.41503068344568, -4.912651715089948],
                  [-79.41441377537225, -4.913036534196837],
                  [-79.41311610362904, -4.91222324617287],
                  [-79.40818083904163, -4.905937831955159],
                  [-79.405906325797, -4.902260623402273],
                  [-79.40629256389515, -4.900764079241554]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "19"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.39339706303267, -4.863085938079452],
                  [-79.39116546513227, -4.865052934499436],
                  [-79.38839127625414, -4.859654693197665],
                  [-79.38950707520434, -4.849306434379009],
                  [-79.39517190064379, -4.839556690082612],
                  [-79.39937760437914, -4.833313358976829],
                  [-79.40126587952562, -4.826471286222868],
                  [-79.41285302246996, -4.804319602936248],
                  [-79.4152562817473, -4.786871438118915],
                  [-79.43104912842699, -4.745815180286271],
                  [-79.44340874756762, -4.764632936255764],
                  [-79.44615532959887, -4.786187187283865]]]),
            {
              "class_original": 27,
              "class_final": 12,
              "system:index": "20"
            })]),
    de_27_a_25 = 
    /* color: #98ff00 */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-78.25378042987413, -7.929709818723104],
                  [-78.25223547748155, -7.9404634406405865],
                  [-78.24755770495958, -7.940080905557237],
                  [-78.24702250652967, -7.939635064259261],
                  [-78.24620711498915, -7.93933753640303],
                  [-78.25054156475721, -7.9287964105110635],
                  [-78.25182902508436, -7.927988813109337]]]),
            {
              "class_original": 27,
              "class_final": 25,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-78.25153035766436, -7.953358530958476],
                  [-78.24818296081378, -7.951743431144147],
                  [-78.24620885497882, -7.945708001880283],
                  [-78.24723882324054, -7.9404375544501695],
                  [-78.2517878497298, -7.940862593040654]]]),
            {
              "class_original": 27,
              "class_final": 25,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-77.79010465999316, -8.169512791774386],
                  [-77.74718931575488, -8.206893296487456],
                  [-77.73791960139941, -8.19941747640312],
                  [-77.75096586604785, -8.17223149218625],
                  [-77.76641538997363, -8.160676887565248],
                  [-77.76710203548144, -8.146403091146164]]]),
            {
              "class_original": 27,
              "class_final": 25,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-77.72819056675114, -8.261308522102226],
                  [-77.72381320163883, -8.26139346212048],
                  [-77.72398486301579, -8.256721733970835],
                  [-77.72261157200016, -8.251200529439364],
                  [-77.72956385776676, -8.250181221702954]]]),
            {
              "class_original": 27,
              "class_final": 25,
              "system:index": "3"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-77.7640240573367, -8.30941035015383],
                  [-77.76076249117459, -8.30941035015383],
                  [-77.76084832186307, -8.30550356709759],
                  [-77.76428154940213, -8.304739191950448]]]),
            {
              "class_original": 27,
              "class_final": 25,
              "system:index": "4"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-77.25158530851324, -9.682253225937558],
                  [-77.24823791166266, -9.681999401593703],
                  [-77.24755126615484, -9.678107404300945],
                  [-77.25295859952887, -9.674299972017227],
                  [-77.2550185360523, -9.676499827043228]]]),
            {
              "class_original": 27,
              "class_final": 25,
              "system:index": "5"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-77.32274716724115, -9.72794881124002],
                  [-77.2815484367724, -9.949855882342359],
                  [-76.99317017913292, -10.047666698801125],
                  [-76.98132554412315, -10.049356980356743],
                  [-76.97583238006065, -10.044117078776926],
                  [-76.97995225310753, -10.02856590354902],
                  [-77.00267631193121, -10.00596304513892],
                  [-77.01417762418707, -9.97367282442586],
                  [-77.01675254484137, -9.950340725192396],
                  [-77.0349486507984, -9.939012220578686],
                  [-77.03220206876715, -9.921257804551818],
                  [-77.03666526456793, -9.910773792620496],
                  [-77.0514281429859, -9.898091072171649],
                  [-77.05486137052496, -9.881180016293033],
                  [-77.06138450284918, -9.867481423587607],
                  [-77.07786399503668, -9.855304418438765],
                  [-77.0957167782398, -9.83720720537615],
                  [-77.11339790006598, -9.830949059848459],
                  [-77.12386924406012, -9.835854102870071],
                  [-77.16335136075934, -9.825198227089258],
                  [-77.18601066251715, -9.833824438723314],
                  [-77.19905692716559, -9.82824279806489],
                  [-77.20437842985113, -9.817586677089212],
                  [-77.2136481442066, -9.82046217210659],
                  [-77.2191413082691, -9.805746140442874],
                  [-77.23682243009527, -9.804223755037253],
                  [-77.23750907560309, -9.7886611923551],
                  [-77.23630744596441, -9.763793410535568],
                  [-77.23184425016363, -9.755080788881669],
                  [-77.22918349882086, -9.737147297527338],
                  [-77.23175841947516, -9.729618327657343],
                  [-77.23356086393316, -9.72530389767032],
                  [-77.22617942472418, -9.71388307899445],
                  [-77.22858268400152, -9.705761370810134],
                  [-77.24137145658453, -9.700431392791208],
                  [-77.24609214445074, -9.704153926050953],
                  [-77.24677878995855, -9.700262185751493],
                  [-77.24986869474371, -9.69755486150021],
                  [-77.25184280057867, -9.698908526358876]]]),
            {
              "class_original": 27,
              "class_final": 25,
              "system:index": "6"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-77.02273451824837, -10.055648682375134],
                  [-76.96230971356087, -10.377309275186793],
                  [-76.7000111295765, -10.77824478684075],
                  [-76.5876796652168, -10.99822498722358],
                  [-76.55472960972551, -10.993180803819072],
                  [-76.55747619175676, -10.883965285905024],
                  [-76.58768859410051, -10.776733336707448],
                  [-76.63712707066301, -10.637747120485361],
                  [-76.69343200230364, -10.545279413637298],
                  [-76.71609130406145, -10.47844237461215],
                  [-76.79509559362778, -10.42375060299282],
                  [-76.80127540319809, -10.384242261179551],
                  [-76.82256141394028, -10.386606148730591],
                  [-76.83732429235825, -10.36397963516191],
                  [-76.85998359411606, -10.358576046775015],
                  [-76.86547675817856, -10.325814799628487],
                  [-76.88058295935043, -10.293387936498862],
                  [-76.900495679077, -10.250484778809108],
                  [-76.90719047277817, -10.19710108853976],
                  [-76.9085637637938, -10.162633444042667],
                  [-76.9118253299559, -10.144722317302364],
                  [-76.91139617651352, -10.134752482419731],
                  [-76.91422858923325, -10.119712653334034],
                  [-76.91980758398422, -10.112276971851522],
                  [-76.92753234594711, -10.100700625234714],
                  [-76.93508544653305, -10.092250474095566],
                  [-76.94778838842758, -10.097067087440763],
                  [-76.95654311865219, -10.106024106477017],
                  [-76.96212211340317, -10.087011268978246],
                  [-76.96564117163071, -10.078729770954224],
                  [-76.97559753149399, -10.066391634446196],
                  [-76.98237815588364, -10.056926442871813],
                  [-76.9846955844725, -10.057095466582537]]]),
            {
              "class_original": 27,
              "class_final": 25,
              "system:index": "7"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-76.61464457131206, -11.038049655089099],
                  [-76.52263407326518, -11.245550235021783],
                  [-76.3976645908433, -11.56862913191141],
                  [-76.25896219826518, -11.80935017655824],
                  [-76.1559653720933, -11.962548684992964],
                  [-75.9966636142808, -12.067318803122452],
                  [-75.8208823642808, -12.029713710223243],
                  [-75.79994048171496, -12.021066803755945],
                  [-75.84491495705424, -11.993614588502913],
                  [-75.8538413486558, -11.992775016493514],
                  [-75.90396647072612, -11.978669816121117],
                  [-75.941045328148, -11.980684889873718],
                  [-75.98842386818706, -11.980013200293694],
                  [-76.04198221779643, -11.885288283557792],
                  [-76.083867593773, -11.826824530383844],
                  [-76.17587809181987, -11.742803027454762],
                  [-76.17381815529643, -11.658755904423842],
                  [-76.1724448642808, -11.594190428559802],
                  [-76.20883707619487, -11.540374456576128],
                  [-76.29398111916362, -11.559211223350678],
                  [-76.32968668556987, -11.51211693593991],
                  [-76.3420463047105, -11.460304113424947],
                  [-76.39011149025737, -11.351264346063934],
                  [-76.44298319435893, -11.305482127472198],
                  [-76.46632914162456, -11.231407181727281],
                  [-76.48143534279643, -11.157986880829576],
                  [-76.483778361334, -11.091605685465494],
                  [-76.50420606519143, -11.074928175777686],
                  [-76.52051389600197, -11.050331326838275],
                  [-76.52549207593361, -11.035673319524912],
                  [-76.5416282453672, -11.027417338209005],
                  [-76.56178418617716, -11.020464500904339],
                  [-76.56667653542033, -11.015030462333321],
                  [-76.56920854073039, -11.012882093829353],
                  [-76.57586041908732, -11.014567090060607],
                  [-76.57916490059367, -11.012208092636483],
                  [-76.58096734505168, -11.012208092636483]]]),
            {
              "class_original": 27,
              "class_final": 25,
              "system:index": "8"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-75.65061610320906, -12.108387638449935],
                  [-75.64744036773543, -12.108891165017164],
                  [-75.6457237539659, -12.105534303304752],
                  [-75.65387766937117, -12.101673860186915],
                  [-75.65628092864851, -12.102009553107024]]]),
            {
              "class_original": 27,
              "class_final": 25,
              "system:index": "9"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-75.64503710845808, -12.145310399758472],
                  [-75.64323466400008, -12.156302324351927],
                  [-75.62727015594344, -12.147575948077103],
                  [-75.62297862151961, -12.137506696891116],
                  [-75.6281284628282, -12.126262249960607],
                  [-75.63276332000594, -12.12827621562335]]]),
            {
              "class_original": 27,
              "class_final": 25,
              "system:index": "10"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-75.66409152129988, -12.169894763187791],
                  [-75.6651214895616, -12.184073788528783],
                  [-75.67001383880476, -12.198084270563626],
                  [-75.65104525665144, -12.221237694989869],
                  [-75.64409297088484, -12.221741007811904],
                  [-75.64246218780379, -12.218721116515763],
                  [-75.65027278045515, -12.211842346571046],
                  [-75.64924281219344, -12.206473426320624],
                  [-75.65662425140242, -12.19548357835324],
                  [-75.65662425140242, -12.18306701880706],
                  [-75.64675372222761, -12.175935623953533],
                  [-75.64683955291609, -12.169643057674607],
                  [-75.64967196563582, -12.165783543281206]]]),
            {
              "class_original": 27,
              "class_final": 25,
              "system:index": "11"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-69.49419585426566, -14.93341523289536],
                  [-69.03277007301566, -14.614722459824065],
                  [-70.06548491676566, -13.975957470171616],
                  [-71.09819976051566, -14.007938551616189],
                  [-71.31558488277376, -14.817794558318258],
                  [-73.93237194821849, -14.262672168734413],
                  [-74.85901196691802, -13.183950889136188],
                  [-75.53667632301566, -12.03855668893933],
                  [-75.65861246539814, -12.23607069418786],
                  [-75.79034291869911, -13.243995617328247],
                  [-74.48296987182411, -14.757658860212448],
                  [-70.92339955932411, -15.975891669440973]]]),
            {
              "class_original": 27,
              "class_final": 25,
              "system:index": "12"
            })]),
    de_27_a_3 = 
    /* color: #0b4a8b */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.4372862662393, -4.922922171679422],
                  [-79.43767250433744, -4.925573102344232],
                  [-79.42565620795072, -4.9253593180049675],
                  [-79.41891849890531, -4.918603697492509],
                  [-79.41466987982572, -4.914285195294578],
                  [-79.4146251651683, -4.913001575011243],
                  [-79.41466271609451, -4.912886663767398],
                  [-79.41470563143875, -4.912870629638775],
                  [-79.41478848719281, -4.912828591425453],
                  [-79.41531420015973, -4.912823246715491]]]),
            {
              "class_original": 27,
              "class_final": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.40437019720854, -4.898806769555103],
                  [-79.39505756750883, -4.892136398170129],
                  [-79.39351261511625, -4.883541783211955],
                  [-79.39123810187162, -4.874818777786831],
                  [-79.39106644049467, -4.8722959266612405],
                  [-79.39063728705229, -4.865368727431322],
                  [-79.39364136114897, -4.863658296889934],
                  [-79.39784706488432, -4.879223054499423],
                  [-79.40531433478178, -4.897438493668596]]]),
            {
              "class_original": 27,
              "class_final": 3,
              "system:index": "1"
            })]),
    hueco = 
    /* color: #ffc82d */
    /* shown: false */
    ee.Geometry.Point([-79.39301741103559, -4.833333860008185]),
    geometry = 
    /* color: #0b4a8b */
    /* shown: false */
    ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Point([-78.5931968621757, -7.175237213497832]),
            {
              "id": 27,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Point([-78.56195449157023, -7.193290463322028]),
            {
              "id": 27,
              "system:index": "1"
            })]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/

            
// Integracion join
var pais = 'PERU';
var id_pais = 13;
var outputAsset = 'projects/mapbiomas-raisg/COLECCION4/INTEGRACION/integracion-pais';
var outputVersion = 9; 

// assets to merge integrate
var assetList = [
  'projects/mapbiomas-raisg/COLECCION4/INTEGRACION/integracion-region/PERU-8-ANDES',
  'projects/mapbiomas-raisg/COLECCION4/INTEGRACION/integracion-region/PERU-8-AMAZ'
  ]
  
// Asset o featurecollecion para remap
var assetsRemap = [
      // 'projects/mapbiomas-raisg/DATOS_AUXILIARES/VECTORES/AJUSTES3/ECUADOR',
      // 'projects/mapbiomas-raisg/DATOS_AUXILIARES/VECTORES/AJUSTES3/PERU',
      de_27_a_12,
      de_27_a_25,
      de_27_a_3
  ];
// import modules
var Legend = require('users/joaovsiqueira1/packages:Legend.js');

var palette = [
    '#ffffff', // [00]      0. Ausência de dados
    '#129912', // [01]      1. Floresta
    '#1f4423', // [02]    1.1. Floresta Natural
    '#006400', // [03]  1.1.1. Formação Florestal
    '#00ff00', // [04]  1.1.2. Formação Savânica
    '#687537', // [05]  1.1.3. Mangue
    '#76a5af', // [06]-
    '#29eee4', // [07]-
    '#77a605', // [08]-
    '#935132', // [09]    1.2. Floresta Plantada
    '#bbfcac', // [10]      2. Formação Natural não Florestal
    '#45c2a5', // [11]    2.1. Área Úmida Natural não Florestal
    '#b8af4f', // [12]    2.2. Formação Campestre
    '#f1c232', // [13]    2.5. Outra Formação não Florestal
    '#ffffb2', // [14]      3. Agropecuária
    '#ffd966', // [15]    3.1. Pastagem
    '#f6b26b', // [16]-
    '#f99f40', // [17]-
    '#e974ed', // [18]    3.2. Agricultura
    '#d5a6bd', // [19]  3.2.1. Lavoura Temporária
    '#c27ba0', // [20]3.2.1.2. Cana
    '#fff3bf', // [21]    3.3. Mosaico de Agricultura ou Pastagem
    '#ea9999', // [22]      4. Área não Vegetada
    '#dd7e6b', // [23]    4.3. Praia e Duna
    '#aa0000', // [24]    4.1. Infraestrutura Urbana //'#aa0000'
    '#ff99ff', // [25]    4.4. Outra Área não Vegetada  //'#ff0000',
    '#0000ff', // [26]      5. Corpo D'água
    '#d5d5e5', // [27]      6. Não Observado
    '#dd497f', // [28]-
    '#b2ae7c', // [29]    2.4. Afloramento Rochoso
    '#580000', // [30]    4.2. Mineração   //'#af2a2a'
    '#8a2be2', // [31]  5.2.3. Aquicultura
    '#968c46', // [32]    2.3. Apicum
    '#0000ff', // [33]    5.1. Corpo dágua Natura
    '#4fd3ff', // [34]    5.3. Glaciais
    '#645617', // [35]-
    '#f3b4f1', // [36]  3.2.3. Lavoura Perene
    '#02106f', // [37]    5.2. Corpo dágua Artificial
    '#02106f', // [38]  5.2.1. Reservatórios
    '#c59ff4', // [39]3.2.1.1. Soja
    '#ba87f8', // [40]3.2.1.3. Arroz
    '#e787f8', // [41]3.2.1.4. Outros
    '#cca0d4', // [42]3.2.2.1. Café
    '#d082de', // [43]3.2.2.1. Citrus
    '#cd49e4', // [44]3.2.2.1. Caju
    '#e04cfa', // [45]3.2.2.1. Outros
];


/**
 * Export to asset
 */
var assetGrids = "projects/mapbiomas-raisg/DATOS_AUXILIARES/ESTADISTICAS/COLECCION4/country";
var paisraster = 'projects/mapbiomas-raisg/DATOS_AUXILIARES/ESTADISTICAS/COLECCION4/country-raster';
var lim_raisg = 'projects/mapbiomas-raisg/DATOS_AUXILIARES/RASTERS/limite-raisg-4';
var regMosaic = 'projects/mapbiomas-raisg/DATOS_AUXILIARES/RASTERS/clasificacion-mosaicos-4'

// clasificacion coleccion 3 se usa para rellenar los pixeles 27 de la col4
var assetRaisgC3 = 'projects/mapbiomas-raisg/public/collection3/mapbiomas_raisg_panamazonia_collection3_integration_v2';
var raisgC3 = ee.Image(assetRaisgC3);
raisgC3 = raisgC3.addBands(
    raisgC3.select(['classification_2020'], ['classification_2021']));
    
var grids = ee.FeatureCollection(assetGrids);
var lim_raisg = ee.Image(lim_raisg);

var grid = grids.filter(ee.Filter.eq('feature_id', id_pais));
var gridMask = ee.Image(paisraster).eq(id_pais).selfMask();

Map.addLayer(grid,{},'COUNTRY')

var integrated = ee.Image()//.select()
// print(integrated)

// Integrate
assetList.forEach(function(id){
  var imageIntegrate = ee.Image(id);
  integrated = integrated.blend(imageIntegrate)
  
})

print(integrated)
// Map.addLayer(grid.geometry().bounds(),{},'GRID')
integrated = integrated.unmask(27)
                       .mask(gridMask);

// REMAP------------------------------------------------------------------------------------

  // load remap polygons
  var remapCollection = ee.FeatureCollection(
      assetsRemap.map(
          function (item) {
              return ee.FeatureCollection(item);
          }
      )
  ).flatten();
  
  // Get remap masks
  var integratedRemaped = remapCollection.iterate(
      function (feature, image) {
          image = ee.Image(image);
  
          var polygon = ee.FeatureCollection(feature);
          var original = ee.Image().paint(polygon, 'class_original')
              .clipToBoundsAndScale(polygon.geometry(), null, null, null, 30);
  
          var final = ee.Image().paint(polygon, 'class_final')
              .clipToBoundsAndScale(polygon.geometry(), null, null, null, 30);
  
          return image.where(image.eq(original), final);
      },
      integrated
  );
  
  
  integratedRemaped = ee.Image(integratedRemaped);
  integratedRemaped = integratedRemaped
                            .where(integratedRemaped.eq(27), 0)
                            .selfMask()
                            .unmask(raisgC3)
                            .mask(gridMask);
//------------------------------------------------------------------------------------





Map.addLayer(integrated,{
                'bands': 'classification_2021',
                'min': 0,
                'max': 45,
                'palette': palette,
                'format': 'png'
            }, 'integrated')


Map.addLayer(integratedRemaped,{
                'bands': 'classification_2021',
                'min': 0,
                'max': 45,
                'palette': palette,
                'format': 'png'
            }, 'integratedRemaped')




Export.image.toAsset({
  'image': integratedRemaped.byte(),
  'description': pais + '-' + outputVersion,
  'assetId': outputAsset + '/' + pais + '-' + outputVersion,
  'pyramidingPolicy': {
      ".default": "mode"
  },
  'region': grid.geometry().bounds(),
  'scale': 30,
  'maxPixels': 1e13
});


